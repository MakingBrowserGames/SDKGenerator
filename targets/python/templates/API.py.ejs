import PlayFab<%- api.name %>Models
import asyncio
import PlayFabHTTP
import PlayFabSettings
import PlayFabErrors
import json

# TODO: move to shared file (useable in other generated files)
def noneOrEmpty(str):
    return str == "" or str == None

<%- generateApiSummary("", api, "description")
%>#class PlayFab<%- api.name %>API:
<% for(var i in api.calls) { var apiCall = api.calls[i];
%><%- generateApiSummary("", apiCall, "summary")
%><%- getDeprecationAttribute("", apiCall)
%>def <%- apiCall.name %>Async(request, customData, extraHeaders):
<%- getRequestActions("    ", apiCall) %>
    httpResult = PlayFabHTTP.DoPost("<%- apiCall.url %>", request, <%- getAuthParams(apiCall) %>, extraHeaders)
    if type(httpResult) is PlayFabErrors.PlayFabError:
        error = httpResult
        #PlayFabSettings.GlobalErrorHandler?.Invoke(error)
        #return PlayFab<%-api.name%>Models.<%- apiCall.result %>(error, customData) # we need to propagate these items, need to reconsider models?
        return PlayFab<%-api.name%>Models.<%- apiCall.result %>()

    resultRawJson = httpResult.text
    # resultData = JsonWrapper.DeserializeObject<PlayFabJsonSuccess<<%- apiCall.result %>>>(resultRawJson)
    resultData = json.loads(resultRawJson)
    result = resultData
    returnable = PlayFab<%- api.name %>Models.<%- apiCall.result %>()
<%- getResultActions("    ", apiCall, api) %>
    return returnable # PlayFab<%- api.name %>Models.<%- apiCall.result %>(result, customData)

<% } %><% if (authKey) {
%># Determine if the client session ticket is set, without actually making it public
# public static bool IsClientLoggedIn()
def IsClientLoggedIn():
    return not (ClientSessionTicket == "" or ClientSessionTicket == None)

def MultiStepClientLogin(needsAttribution):
    if needsAttribution and not PlayFabSettings.DisableAdvertising and not noneOrEmpty(PlayFabSettings.AdvertisingIdType) and not noneOrEmpty(PlayFabSettings.AdvertisingIdValue):
        request = AttributeInstallRequest()
        if AdvertisingIdType == AD_TYPE_IDFA:
            request.Idfa = AdvertisingIdValue
        elif AdvertisingIdType == AD_TYPE_ANDROID_ID:
            request.Adid = PlayFabSettings.AdvertisingIdValue
        else:
            return None
        return AttributeInstallAsync(request)
    return None
<% } %>
